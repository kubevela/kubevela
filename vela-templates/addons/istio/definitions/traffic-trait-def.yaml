# Code generated by KubeVela templates. DO NOT EDIT. Please edit the original cue file.
# Definition source cue file: vela-templates/definitions/internal/volumes.cue
apiVersion: core.oam.dev/v1beta1
kind: TraitDefinition
metadata:
  annotations:
    definition.oam.dev/description: use istio to manage traffic
  name: canary-traffic
  namespace: vela-system
spec:
  appliesToWorkloads:
    - deployments.apps
  podDisruptive: true
  schematic:
    cue:
      template: |

        outputs: virtualService: {
            apiVersion: "networking.istio.io/v1alpha3"
            kind: "VirtualService"
            metadata: {
                name:      context.name
                namespace: context.namespace
            }
            spec: {
               hosts: [context.name]
            }
        }

        outputs: destinationRule: {
               apiVersion: "networking.istio.io/v1alpha3"
               kind: "DestinationRule"
               metadata: {
                   name:      context.name
                   namespace: context.namespace
               }
               spec: {
                  host: context.name
               }
        }

        parameter: {
           port: [int]
        }

