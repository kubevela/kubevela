apiVersion: core.oam.dev/v1beta1
kind: TraitDefinition
metadata:
  name: rollout
  namespace: rollout-trait-test
spec:
  manageWorkload: true
  skipRevisionAffect: true
  schematic:
    cue:
      template: |
        outputs: rollout: {
                	apiVersion: "standard.oam.dev/v1alpha1"
                	kind:       "Rollout"
                	metadata: {
                		 name:  context.name
                         namespace: context.namespace
                	}
                	spec: {
                           targetRevisionName: parameter.targetRevision
                           componentName: context.name
                           rolloutPlan: {
                           	rolloutStrategy: "IncreaseFirst"
                            rolloutBatches:[
                            	{ replicas: parameter.firstBatchReplicas},
                            	{ replicas: parameter.secondBatchReplicas}]
                            targetSize: parameter.targetSize
                           }
                		 }
                	}

                 parameter: {
                     targetRevision: *context.revision|string
                     targetSize: *5|int
                     firstBatchReplicas: *2|int
                     secondBatchReplicas: *3|int
                 }