apiVersion: core.oam.dev/v1beta1
kind: Application
metadata:
  name: http-poll-demo
  namespace: default
spec:
  components: []
  workflow:
    steps:
      - name: create
        type: http-post
        properties:
          endpoint: https://httpbin.org
          uri: /anything
          method: POST
          body:
            name: "job-1"
        outputs:
          - name: createdId
            valueFrom: output.body.json.name
      - name: poll
        type: http-get-wait
        inputs:
          - from: createdId
            parameterKey: id
        properties:
          endpoint: https://httpbin.org
          uri: /anything
          header:
            Content-Type: application/json
          # continue when "json.name" echoes back our id
          continueExpr: output.body.json.name == parameter.id
          message: "Waiting for GET to reflect created id"

