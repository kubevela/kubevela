# Code generated by KubeVela templates. DO NOT EDIT. Please edit the original cue file.
# Definition source cue file: vela-templates/definitions/internal/volumes.cue
apiVersion: core.oam.dev/v1beta1
kind: TraitDefinition
metadata:
  annotations:
    definition.oam.dev/description: use istio to manage traffic
  name: traffic-gateway
  namespace: vela-system
spec:
  appliesToWorkloads:
    - deployments.apps
  podDisruptive: true
  schematic:
    cue:
      template: |

        outputs: gateway: {
            apiVersion: "networking.istio.io/v1alpha3"
            kind: "Gateway"
            spec: {
              selector: {
                istio: parameter.gateway
              }
              servers: [{
                 hosts: parameter.hosts
                 port: {
                      name: "http"
                      number: 80
                      protocol: "HTTP"
                 }
              }]
            }
        }

        outputs: virtualService: {
            apiVersion: "networking.istio.io/v1alpha3"
            kind: "VirtualService"
            spec: {
               gateways: [context.name]
               hosts: parameter.hosts
            }
        }

        outputs: destinationRule: {
               apiVersion: "networking.istio.io/v1alpha3"
               kind: "DestinationRule"
               spec: {
                  host: context.name
               }
        }

        parameter: {
           hosts: [string]
           gateway: *"ingressgateway"|string
        }

